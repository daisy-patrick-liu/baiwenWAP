<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>注册弹窗</title>
<link rel="stylesheet" href="style/css/reset.css">
<link rel="stylesheet" href="style/css/layout.css">
<script src="script/jquery-1.8.3.min.js"></script>
<script src="script/Validform_v5.3.2.js"></script>
<style>
  .send {
    width: 120px !important;
    padding: 0 !important;
  }
</style>
</head>

<body class="layer_reg">
  <div class="content">
    <div class="logo_wrap clearfix">
      <img src="style/images/logo_13.png" alt="" class="fl">
    </div>
    <form id="frm_register" class="frm_login_reg" action="#" method="post">
      <div class="title clearfix">
        <hr size="1" width="100%" color="#eee" style="margin-top: 18px;" noshade>
        <span class="abs_txt">会员注册</span>
      </div>

      <div class="input-group">
        <div class="input-wrap">
          <input type="text" class="input_user" id="userid" name="userid" placeholder="请输入您的邮箱/手机号码" datatype="e|m" nullmsg="请输入用户名" errormsg="请输入邮箱/手机号">
        </div>
        <div class="Validform_checktip"></div>
      </div>

      <div>
        <div class="input-wrap">
          <input type="text" class="input_verify" id="valid_code" name="valid_code" placeholder="请输入验证码" datatype="*" nullmsg="请输入验证码" style="width: 260px;">
          <input type="button" class="send" value="发送验证码" id="btnGetCodeNum" disabled="">
        </div>
        <div class="Validform_checktip"></div>
      </div>

      <div class="input-group">
        <div class="input-wrap">
          <input type="password" class="input_pwd" id="pwd" name="pwd" placeholder="请输入密码" datatype="*" nullmsg="请输入密码">
        </div>
        <div class="Validform_checktip"></div>
      </div>

      <div class="input-group">
        <div class="input-wrap">
          <input type="password"  class="input_pwd" id="pwd2" name="pwd2" placeholder="请重复输入密码" datatype="*" recheck="pwd" errormsg="您两次输入的账号密码不一致！">
        </div>
        <div class="Validform_checktip"></div>
      </div>

      <div class="input-group">
        <div class="input-wrap">
          <input type="text" class="input_verify" id="valid_code" name="valid_code" placeholder="请输入右侧验证码" datatype="*" nullmsg="请输入验证码" style="width: 260px;">
          <img src="style/images/valid_code_03.jpg" alt="">
        </div>
        <div class="Validform_checktip"></div>
      </div>

      <div class="input-group" style="margin-top: 20px;">
        <input type="checkbox" id="is_accept" name="is_accept">
        <label for="is_accept">
          同意并接受<a href="#" class="link_txt">《百问会员服务协议》</a>
        </label>
      </div>

      <div class="button">注 册</div>
    </form>
    <div style="text-align: center;">已有账号？点击这里<a href="登录弹窗.html" class="link_txt">登录</a></div>
  </div>
</body>
<script src="script/jquery.enplaceholder.js"></script>
<script src="script/mock.js"></script>
<script>  
$(function() {
  $('input').placeholder({isUseSpan:true});

  $("#frm_register").Validform({
    tiptype:2
  });

  $(".send").css('background', '#ccc');

  // 立即发送验证码按钮变化
  var reg_m = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
  var reg_e = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;

  var isClick = false;
  //倒计时
  var wait = 60;
  function time(o) {
      if (wait == 0) {
          o.removeAttribute("disabled");
          o.setAttribute("style", "");
          o.value = "发送验证码";
          wait = 60;
          $('.spokesman-telInput').show();
          $('.spokesman-telStr').hide();
          isClick = false;
      } else {                      
        isClick=true;
          o.setAttribute("disabled", true);
          o.setAttribute("style", "background: #ccc; color: #fff");
          o.value = wait + "秒后重新获取";
          wait--;
          setTimeout(function() {
                  time(o)
          },
              1000)
      }
  }

  var btnGetCodeNum = document.getElementById("btnGetCodeNum");
  //测试倒计时
  //time(btnGetCodeNum);
  btnGetCodeNum.onclick = function() {

    Mock.mock("http://g.cn", {
      'status': 200,
      'msg': 'success'
    })
    $.ajax({
      url: 'http://g.cn',
      dataType: 'json',
      error: function() {
        /* Act on the event */
        alert("请勿刷新接口");
      },
      success: function(data) {
        if (data.status != 200) {
          isClick = false;
          alert(data.msg);                
        } else {
          //如果能够点击，触发发短信的事件
           time(btnGetCodeNum);
        }

      }
    })
  }


  var temp = document.getElementById("userid");

  $(".input_user").bind("input", function() {
    if(isClick == false){
      if (!reg_m.test(temp.value) && !reg_e.test(temp.value)) {
          $(".send").attr('disabled', true);
          $(".send").css('background', '#ccc');

      } else {

          $(".send").css('background', '#a1ce83');
          $(".send").attr("disabled", false);

      }
    }

  })

  $('.mobileInput').bind('input propertychange', function() {
    if(isClick == false){
       if ($(this).val() == "") {
                $(".send").css('background', '#a1ce83');
                $(".send").attr('disabled', true);
         }
    }
    
  });

})
</script>
</html>
